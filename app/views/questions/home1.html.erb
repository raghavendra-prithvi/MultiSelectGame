
<%= javascript_include_tag "iosOverlay.js","modernizr-2.0.6.min" %>
<%= stylesheet_link_tag "iosOverlay.css" %>
<script>
    $(document).ready(function() {
            $(".btn-lg").css("display", "none");
            $(".btn-lg").fadeIn(800);
            $(".prod_img").css("display", "none");
            $(".prod_img").fadeIn(1000);
    });
</script>
<div class="container-narrow">
      <div class="navbar-header">
          <div class="backbtn"></a>
          </div>
           <div class="col-sm-10 text-center"><center><h3 style="margin-bottom: 20px; margin-top:20px">NAME that DESIGNER<span id="score_me"><%=@score.points%></span></h3></center></div>
           
            <%#if !session[:user_id].nil?%>
                     <%# @user = User.find_by_uid(session[:user_id]) %>
                    <%#=image_tag(@user.img,:style => "left:0; top:0; margin-top:0px; z-index: 999999; border-radius:30px;", :size => '50x50') %>
            <%# end %>
      </div>
      <div class="jumbotron">
          <div class="prod_img" style="margin-top:20px; margin-bottom:20px;">
            <%=image_tag "https://api.svpply.com/v1/products/#{@product[0].product_id}/image?type=medium", :class => "img-thumbnail", :alt=> "", :style => "max-height:340px" %>
                    <div class="win">
                <a href=<%=@buy_url%> target="_blank"><i type="button" hidden="hidden" id="btn-buy" onclick="" value="" style="display:none"><i class="icon-tag "></i></i></a>
        <i type="button" hidden="hidden" id="btn-next" onclick="nextPage()" value="" style="display:none"><i class="icon-arrow-right"></i></i>
      </div>
        </div>
    </div>
      <div class="row">
        <div class="col-lg-12" style="margin-top: 200px; padding-bottom:20px;">
          <% @selected_store_names.each do |a| %>
          <a href="#" onclick="checkAnswer(this.id)" class="btn btn-danger btn-lg btn-block" id=<%= a.gsub(/\W+/, '') %> ><%= a %> </a>
            <%#*<a class="btn btn-danger btn-lg btn-block" href="#">INCORRECT</a>%>
          <% end %>
          <%#*<a class="btn btn-success btn-lg btn-block" href="#">CORRECT</a>%>
          <%#*<a class="btn btn-danger btn-lg btn-block" href="#">INCORRECT</a>%>
          <%#*<a class="btn btn-danger btn-lg btn-block" href="#">INCORRECT</a>%>
        </div>
    </div>
</div>
</div>


<script>
  $(document).ready(function(){
   // $(".ansChoice input[type=radio]").change( function() { alert('wtf'); });
   var opts = {};
    var target = document.getElementById('prod_img');
    var spinner = new Spinner(opts).spin(target);
   $('input:radio[name="answer"]').change(
    function(){
        if ($(this).is(':checked')) {
          var idVal = $(this).val();
          
          $.ajax({
              url: "/check_me",
              type: "post",
              data: {'val' : idVal },
              success: function(data){
                console.log(data);
                if(data == 'true' || data == true){
                  $("#Status").attr('style','color:#68DDAB');
                  $("#btn-next").show();
                  $("#btn-buy").show();
                }
                else{
                  $("#Status").attr('style','color:#AAAAAA');
                }
              }
          });
            // append goes here
        }
    });

  });
  function nextPage(){
    window.location.href = '/home'
  }
   function checkAnswer(idVal){
    //$("#"+idVal).attr("onclick","#");
    $("#"+idVal).removeAttr("onclick");
    //this.attr("onclick","function(){}");
    $.ajax({
              url: "/check_me",
              type: "post",
              data: {'val' : idVal },
              success: function(data){
                console.log(data);
                if(data.achieved == true){
                  iosOverlay({
                          text: data.badge_name,
                          duration: 2e3,
                          icon: data.badge_url
                  });
                }
                if(data.valid == 'true' || data.valid == true){
                  $("#"+idVal).attr('style','background-color:#68DDAB');
                  $("a.btn").removeAttr("onclick");
                  $("#btn-next").show();
                  $("#btn-next").fadeIn(1000);
                  $("#btn-buy").show();
                  $("#score_me").html(data.score);
                }
                else if(data.valid == 'false' || data.valid == false){
                  //$("#Status").html("Sorry.. You made a wrong choice.");
                  //$("#Status").attr('style','color:red');
                  $("#"+idVal).attr('style','background-color:#cccccc');
                }
                else{
                  window.location.href = '/over'
                }
              }
          });
  }
</script>