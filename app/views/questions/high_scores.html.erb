<link href='http://fonts.googleapis.com/css?family=Raleway|Raleway+Dots' rel='stylesheet' type='text/css'></link>
 <div class="container-narrow">
      <div class="jumbotron">
        <h1>HIGH SCORES</h1>
      </div>
      <row>
      	<div class="col-lg-12">
      	<ul class="nav nav-pills">
  <li class="active"><a href="#" onclick="selfScores();$('li').removeAttr('class');$(this).parent('li').attr('class','active')">YOUR SCORES</a></li>
  <li><a href="#" onclick="friendScores();$('li').removeAttr('class');$(this).parent('li').attr('class','active')">FRIENDS</a></li>
  <li><a href="#" onclick="globalScores();$('li').removeAttr('class');$(this).parent('li').attr('class','active')">GLOBAL</a></li>
  </ul>
  </div>
<%=hidden_field_tag :auth_token,session[:access_token],:id => "access_tkn"%>
      	<table class="table" id="data_table">
        <tbody id="selfData">
          <% @user = User.find_by_uid(session[:user_id]) %>
          <% i = 1 %>
          <% @scores.each do |s| %>
          <tr>
            <% if i < 4 %>
              <td><h4><%=image_tag(@user.img, :size => '25x25' )%></h4></td>
              <td><h4><%=@user.name %></h4></td>
              <td><h4><%=s.points %></h4></td>
            <% else %>
              <td><h4><%=image_tag(@user.img) %></h4></td>
              <td><h4><%=@user.name %></h4></td>
              <td><h4><%=s.points %></h4></td>
            <% end %>
          </tr>
          <% end %>   
          </tbody>
      	</table>
    </row>
      <div class="row marketing">
        <div class="col-lg-12">
          <a class="btn btn-playagain btn-lg text-center" href="/start">PLAY AGAIN</a>
        </div>
      </div>

    </div> <!-- /container -->

    <script type="text/javascript">
      function friendScores(){
        var token = $("#access_tkn").val();
        $.ajax({
                url: "https://graph.facebook.com/me/friends?fields=installed&installed=true&access_token="+token,
                type: "GET",
                success: function(resp){
                  console.log(resp);
                  var arr = [9, 9, 111, 2, 3, 4, 4, 5, 7];
                  var friends_data = resp.data
                  //var sorted_arr = friends_data.sort(); // You can define the comparing function here.
                                               // JS by default uses a crappy string compare.
                  var results = [];
                  for (var i = 0; i < friends_data.length - 1; i++) {
                      if (friends_data[i].installed == true) {
                          results.push(friends_data[i].id);
                      }
                  }
                  getFriendsData(results);
                  console.log(results);
                }
            });
      }

      function getFriendsData(arrObj){
        $.ajax({
                      url: "/getFriendsData",
                      type: "GET",
                      data: {'ids' : arrObj },
                      success: function(response){
                        $("#data_table").html(response);
                        //$("#selfData").hide();
                      }
                  });
      }

      function selfScores(){window.location.href = "/highscores"
      };

      function globalScores(){
        $.ajax({
                      url: "/getGlobalData",
                      type: "GET",
                     // data: {'ids' : arrObj },
                      success: function(response){
                        $("#data_table").html(response);
                        //$("#selfData").hide();
                      }
                  });
      }

    </script>